var colorBuilder={hslToRgb:function(h,c,g){var d,i,a;if(+c===0){d=i=a=g}else{var b=function(l,k,j){if(j<0){j+=1}if(j>1){j-=1}if(j<1/6){return l+(k-l)*6*j}if(j<1/2){return k}if(j<2/3){return l+(k-l)*(2/3-j)*6}return l};var e=g<0.5?g*(1+c):g+c-g*c;var f=2*g-e;d=b(f,e,h+1/3);i=b(f,e,h);a=b(f,e,h-1/3)}return[Math.round(d*255),Math.round(i*255),Math.round(a*255)]},randomHsl:function(){var c=Math.random();var b=Math.random();var a=Math.random();return[c,b,a]},getHslArray:function(c){var d=[];for(var b=0;b<c;b++){var a=this.randomHsl();if(b>0&&Math.abs(a[0]-d[b-1][0])<0.25){b--;continue}a[1]=0.7+(a[1]*0.2);a[2]=0.4+(a[2]*0.4);a=a.map(function(e){return parseFloat(e.toFixed(2))});d.push(a)}return d}};(function(n,p,u){var w=n([]),s=n.resize=n.extend(n.resize,{}),o,l="setTimeout",m="resize",t=m+"-special-event",v="delay",r="throttleWindow";s[v]=250;s[r]=true;n.event.special[m]={setup:function(){if(!s[r]&&this[l]){return false}var a=n(this);w=w.add(a);n.data(this,t,{w:a.width(),h:a.height()});if(w.length===1){q()}},teardown:function(){if(!s[r]&&this[l]){return false}var a=n(this);w=w.not(a);a.removeData(t);if(!w.length){clearTimeout(o)}},add:function(b){if(!s[r]&&this[l]){return false}var c;function a(d,h,g){var f=n(this),e=n.data(this,t);e.w=h!==u?h:f.width();e.h=g!==u?g:f.height();c.apply(this,arguments)}if(n.isFunction(b)){c=b;return a}else{c=b.handler;b.handler=a}}};function q(){o=p[l](function(){w.each(function(){var d=n(this),a=d.width(),b=d.height(),c=n.data(this,t);if(a!==c.w||b!==c.h){d.trigger(m,[c.w=a,c.h=b])}});q()},s[v])}})(jQuery,this);function isMobile(){if((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))){return true}return false}function trim(a){if(a==null){a=""}return a.replace(/(^\s*)|(\s*$)/g,"")}var shareWeibo=function(d,b,c){var a="http://v.t.sina.com.cn/share/share.php?title="+d+"&url="+b+"&content=utf-8&sourceUrl="+b+"&pic="+(c||"");window.open(a,"newwindow","height=400,width=400,top=100,left=100")};var buildTimeout,startTimeV;function startTime(c){startTimeV=c;var b=new Date().getTime()-new Date(startTimeV);if(b<0){return"0秒"}var a="";if(b>=365*86400000){a+=parseInt(b/(365*86400000))+"年";b=(b%(365*86400000))}if(b>=86400000){a+=parseInt(b/86400000)+"天";b=(b%86400000)}if(b>=3600000){a+=parseInt(b/3600000)+"小时";b=(b%3600000)}if(b>=60000){a+=parseInt(b/60000)+"分";b=(b%60000)}a+=parseInt(b/1000)+"秒";$("#build-time").html(a);buildTimeout=setTimeout("startTime(startTimeV)",1000)}function resizeMenuTreeHeight(){var a=$(window).height()-16;$(".article-title-list-w").css("height",a+"px");$(".article-title-list").css("max-height",a-168+"px")}$(function(){var m=$("header");var k=0;var y=$(".mdl-layout__content"),x=$("#drawer");var n="is-visible";var j=$(".menu-list");var v=$(".menu-switch");var t=$("#screen-mask");$.showSnackbar=function(C){var A=document.querySelector("#demo-snackbar-example");var B={message:C,timeout:2000};A.MaterialSnackbar.showSnackbar(B)};$.gotoAnchorSmooth=function(A,C,B){C=C||0;B=B||300;if(A instanceof $&&A.length){y.animate({scrollTop:A.offset().top+y.scrollTop()+C},B)}};function b(){return y.scrollTop()}function l(){$(".right-drawer").addClass("close");$("#drawer").removeClass(n);t.fadeOut(200)}function f(){t.fadeIn(200)}(function(){t.on("click",function(){l()})})();$.closeDrawer=function(){l()};function w(){x.addClass(n);f()}(function(){$("#list-drawer-btn").on("click",function(){$(".right-drawer").toggleClass("close");if($(".right-drawer").hasClass("close")&&!$("#drawer").hasClass(n)){l()}else{$("#drawer").removeClass(n);f()}});$(".right-drawer .c").on("click",function(A){$(".right-drawer").addClass("close");l();var B=$(this);if(B.hasClass("liji")){B.removeClass("liji");return}B.addClass("liji");A.preventDefault();setTimeout(function(){B.trigger("click")},200)})})();function u(){y.scroll(function(){var A=$(this)[0].scrollTop;if(A>120&&A>k){m.addClass("main-header-close")}else{if(A<k&&m.hasClass("main-header-close")){m.removeClass("main-header-close")}else{if(A<=120){m.removeClass("main-header-close")}}}k=A});$(".my-drawer-button").on("click",function(){if(x.hasClass(n)){$.closeDrawer()}else{w()}})}var o;function s(){o=$(".menu-target-fix");var B=b();for(var A=0;A<o.length;A++){o[A].topHeight=$(o[A]).offset().top+B;o[A].id=$(o[A]).attr("id")}}function i(E,B,C){if(o.length===0){return null}if(B-E<=1){if(o[B].topHeight<C){return o[B]}return o[E]}if(E<B){var D=parseInt((E+B)/2);var A=o[D].topHeight;if(C<A){B=D}else{if(C>A){E=D}else{return o[D]}}return i(E,B,C)}}function c(){if($("#article-index-w").length){if($(document).width()<480){$("#index-button").show();$("#article-index-w").removeClass("article-title-list-w mdl-cell--3-col mdl-cell--hide-phone mdl-cell--2-col-tabvar").addClass("index-card mdl-card mdl-shadow--2dp mdl-cell--hide-desktop mdl-cell--hide-tablet");$(".index-card").on("click",function(A){A.stopPropagation()});$(document).on("click",function(){$(".index-card").slideUp(200)})}else{$("#index-button").hide();$("#article-index-w").removeClass("index-card mdl-card mdl-shadow--2dp mdl-cell--hide-desktop mdl-cell--hide-tablet").addClass("article-title-list-w mdl-cell--3-col mdl-cell--hide-phone mdl-cell--2-col-tablet")}}else{$("#index-button").hide()}}function h(){c();var A=$(".article-title-list");if(A.length===0){return}resizeMenuTreeHeight();$.titleScrollEnabled=true;var E=$(".index-menu-list .index-menu-list");s();function D(){return A.find(".current")}function F(){var I=D();if(I.length){I.removeClass("current")}}y.scroll(function(){if(!$.titleScrollEnabled){return}var I=i(0,o.length-1,b());if(!I){return}F();var J=A.find('a[href="#'+I.id+'"]');if(!J.hasClass("current")){J.addClass("current");E.removeClass("open");J.parents(".index-menu-list").addClass("open").slideDown();J.next(".index-menu-list").addClass("open").slideDown();E.not(".open").slideUp()}H(J.parent())});var B=null;$(".index-menu-link").on("click",function(J){J.preventDefault();var I=$(this);$.titleScrollEnabled=false;clearTimeout(B);F();I.addClass("current");E.removeClass("open");I.parents(".index-menu-list").addClass("open");I.parent(".index-menu-item").children(".index-menu-list").addClass("open").stop(false,true).slideDown();E.not(".open").stop(false,true).slideUp();var K=I.attr("href");$.gotoAnchorSmooth($(K));B=setTimeout(function(){$.titleScrollEnabled=true},1000)});var G=$(".index-menu  .index-menu-item")[0],C=$(".index-menu");function H(K){if(A.height()>=C.height()){return}var I=D().parent()[0].getBoundingClientRect().top;var J=G.getBoundingClientRect().top;A.stop().animate({scrollTop:I-J-K.height()},300)}}function r(){if(j.length){v.on("click",function(){var C=$(this).is("a")?$(this):$(this).parent("a");var B=C.parent("li");var A=C.next(".menu-sub-list");v.on("click",function(D){return false});if(B.hasClass("open")){B.removeClass("open");A.stop(false,true).slideUp(200)}else{j.find(".open").not(C.parents(".open")[0]).removeClass("open").find(" .menu-sub-list").stop(false,true).slideUp(200);B.addClass("open");A.stop(false,true).slideDown(200)}})}$(".close-drawer").on("click",function(){$.closeDrawer()})}$.pageNav=function(){$(".page-navigator .current a").addClass("mdl-color--primary");$(".page-navigator li:not(.current) a").addClass("mdl-color-text--primary")};function z(){var A=$("#to_top"),D=$("footer"),B=68;if(A.length){A.click(function(){y.animate({scrollTop:0},200)});y.scroll(function(){var E=D.offset().top-$(window).height();if(-E>B){A.removeClass("fixed")}else{A.addClass("fixed")}C()});function C(){var E=y.scrollTop();if(E>300){A.removeClass("hide")}else{A.addClass("hide")}}C()}}$.postNear=function(){var B=$(".post-near");if(B.length){var A=B.children("li");A.each(function(){var D=$(this);var C=D.children("a");if(C.length){D.addClass("enabled")}})}};$.articleImage=function(){$(".post-card img").not('.image-no-show, .image-no-show img, a[data-fancybox="gallery"] img').each(function(){var A=$(this);A.wrap("<a data-fancybox='gallery' href='"+A.attr("src")+"' data-caption='"+A.attr("title")+"'></a>");A.attr("title","").attr("alt","")});$('[data-fancybox="gallery"]').fancybox({loop:true,buttons:["zoom","slideShow","fullScreen","thumbs","close"]})};function g(){$(".article-content").each(function(){var B=$(this);B.html(B.html().replace(/(<br>){2,}/ig,"<br>"));B.find("a").attr("target","_block");B.find("table").wrap('<div class="scroll-bar table-wrap"></div>');if(B.find("form.protected").length){B.find("form.protected input[type=submit]").addClass("mdl-button mdl-js-button mdl-button--raised");B.parents(".post-card").addClass("post-card-protected")}});try{Prism.highlightAll()}catch(A){}}function q(){var B=$("#revolvermaps");if(B.length&&B.css("display")!="none"){var C=B.find(".maps-w");if(B.find("script").length==0){var A=document.createElement("script");A.type="text/javascript";A.src=C.data("src")+"?_dc="+new Date().getTime();A.async=true;C.html(A)}C.css("height",B.width())}}(function(){$("#index-button").on("click",function(B){var A=$(".index-card");if(!A.length){return}if(A.css("display")==="none"){A.slideDown(200)}else{A.slideUp(200)}B.stopPropagation()})})();var p=null;var e=function(){if($("#load-more").is(p)){return}else{p=$("#load-more")}if($(".post-card").length<typechoConf.pageSize||$("#tag-no-more").length){$("#load-more").html("到底了");return}var B=false;if(p.length==0){return}p.unbind("click").on("click",function(){if(C()){return}$.ajax({url:window.location.href+"?page="+($(".post-card").length/typechoConf.pageSize+1),type:"GET",dataType:"html",error:function(){A(false,true)},success:function(D){if(false==D){A();return}var E=$("<code></code>").append($(D));if(E.find("#no-more").length){A(true);return}$(".post-card").last().after($(D).hide().fadeIn(300));A($("#tag-no-more").length);g();$.articleImage()}})});var C=function(){if(B){return true}B=true;$("#load-more .description").html("请稍等");$("#load-more-anim").addClass("spinner");return false};var A=function(E,D){E=E||false;D=D||false;B=false;$("#load-more-anim").removeClass("spinner");if(E){$("#load-more").html("到底了").unbind("click")}else{$("#load-more .description").html(D?"加载失败，请重试":"加载更多")}}};var a=function(){var B=$(".tag-wrapper a");if(B.length){var A=colorBuilder.getHslArray(B.length);B.each(function(D){var C="rgb("+colorBuilder.hslToRgb(A[D][0],A[D][1],A[D][2]).toString()+")";$(this).css("color","white").css("background-color",C)})}B=$(".tag-cloud a");if(B.length){var A=colorBuilder.getHslArray(B.length);B.each(function(D){var C="rgb("+colorBuilder.hslToRgb(A[D][0],A[D][1],A[D][2]).toString()+")";$(this).css("color","white").css("background-color",C)})}};a();var d=function(){if(isMobile()){return}y.niceScroll({cursorcolor:"#d0d0d0",horizrailenabled:false});$(".page-content").bind("resize",function(){y.getNiceScroll().resize();s()})};$(window).resize(function(){resizeMenuTreeHeight();q();c()});u();r();z();q();titleTooltip();d();$.completePjax=function(){a()};$.afterPjax=function(){g();h();$.articleImage();$.postNear();e();$.pageNav();$.commentsAjax();q();y.getNiceScroll().resize();$(".post-card").bind("resize",function(){y.getNiceScroll().resize()})};$.afterPjax()});$.commentsAjax=function(){restNoPjaxClass();$.doingSubmit=false;$("#comment-form").submit(function(d){if(b()){return false}d.preventDefault();var e=false,c=$(this).serializeArray();$.each(c,function(f,g){if(g.name=="parent"){e=true}});$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:c,error:function(){a();$.showSnackbar("提交失败！")},success:function(g){console.log(g);a();if(!$("#comments",g).length){var i=$("<code></code>").append($(g)).find(".container, h1");if(i.length){i=i.html()}else{i=g}$.showSnackbar("提交失败:  "+i);return false}$.showSnackbar("评论成功!");var f=$("#comments",g).html().match(/id="?comment-\d+/g).join().match(/\d+/g).sort(function(k,j){return k-j}).pop();if($(".page-navigator li").length===0||$(".page-navigator .prev").length===0||e){$("#comments").html($("#comments",g).html());reUpgradePageDem();$.articleImage();$.pageNav();$.commentsAjax();$("#mdl-layout-content").animate({scrollTop:$("li[id=li-comment-"+f+"]").offset().top+$("#mdl-layout-content").scrollTop()},300);return}var h=$("#comments .page-navigator .prev").next().find("a");h.trigger("click")}})});function b(){if($.doingSubmit){return true}$.doingSubmit=true;$("#comment-form button[type=submit]").addClass("submit-loading").find(".material-icons").html("toys");return false}function a(){$.doingSubmit=false;$("#comment-form button[type=submit]").removeClass("submit-loading").find(".material-icons").html("check")}};function restNoPjaxClass(){$(".comment-reply a, .cancel-comment-reply-link").addClass("no-pjax")}var titleTooltip=function(){$(".article-content .avatars").find("a").each(function(a){if($(this).attr("title")){$(this).mouseover(function(f){var e=$(this).attr("title");var c="";$(this).attr("title","");var b=$(this).attr("href");if(b&&!b.startsWith("#")){c="点击传送："+b}$("body").append('<div id="tooltip"><span class="title">'+e+"</span><br>"+c+"</div>");$("#tooltip").css({left:(f.pageX+16)+"px",top:(f.pageY+16)+"px"}).fadeIn(150)}).mouseout(function(){$(this).attr("title",$("#tooltip .title").html());$("#tooltip").remove()}).mousemove(function(b){$("#tooltip").css({left:(b.pageX+16)+"px",top:(b.pageY+16)+"px"})})}})};function reUpgradePageDem(){var b=$("#page-content");b.find("*[class^=mdl]").removeClass("is-upgraded").removeAttr("data-upgraded");b.find(".mdl-menu__item-ripple-container").remove();b.find(".mdl-js-ripple-effect--ignore-events").removeClass("mdl-js-ripple-effect--ignore-events");var a=b.find(".mdl-menu__container");a.each(function(){$(this).after($(this).html());$(this).remove()});componentHandler.upgradeDom()};